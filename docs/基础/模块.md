---
name: 模块
icon: material/package-variant-closed
comments: true
---

## 模块、包和库

- 模块: 一堆函数、类、变量的集合
- 包: 一个包可能由多个模块组成
- 库: 一个库可能由多个包和模块组成

### 模块

以`.py`为后缀的文件, 称之为模块. 

???+ example "例子"

    假设现在有一个名为demo.py的文件: 

    ```py
    name = "wenzexu"
    print("导入成功")
    ```

    直接使用`import`语句就能导入, 导入之后, 可以使用`模块名.变量名`的方式访问这个变量:

    ```
    >>> import demo
    导入成功 # 由于未定义__name__, 导致顶层代码执行
    >>> demo.name
    'wenzexu'
    ```

???+ warning "注意"

    在导入模块之后, 模块之内所有未包裹在函数或者类里面的代码都会被执行. 如果你希望在导入包之后不执行顶层代码, 可以使用`__name__`参数. 这是一个特殊的内置变量, 一个文件被直接运行的时候, 其内部的`__name__`会被解释器设为`__main__`; 一个文件被作为模块导入的时候, `__name__`的值被设置为该模块的名字.

    ???+ example "例子"

        假设现在有一个名为demo.py的文件:

        ```py
        name = "wenzexu"

        def main():
            print("导入成功")
            print(__name__)

        if __name__ == "__main__":
            main()
        ```

        运行demo.py:

        ```sh
        $ python demo.py
        导入成功
        __main__
        ```

        在另一个文件run.py导入这个demo.py模块: 

        ```py
        import demo
        print(demo.name)
        ```

        运行run.py:

        ```sh
        $ python run.py
        wenzexu
        demo
        ```

???+ tip "Tip"

    当模块被导入之后, 会在当前目录下产生一个叫做`__pycache__`的缓存文件夹. 这里面的文件是模块被导入之后解释器根据模块代码编译生成的字节码. 这样如果以后再次运行的话. 如果调用的模块未发生改变, 那就直接跳过编译这一步, 直接去`__pycache__`文件夹里去运行相关的`*.pyc`文件, 大大缩短了项目运行前的准备时间.

    ???+ example "例子"

        ```sh
        $ tree .
        .
        ├── __pycache__
        │   └── demo.cpython-312.pyc
        ├── demo.py
        └── run.py
        ```

### 包

## 导入

### `sys.path`

当我们导入包或者模块的时候, Python解释器会在这两个地方寻找包或者模块:

1. `sys.path`
2. 运行文件所在的目录

???+ tip "Tip"

    可以通过`sys`模块查看`sys.path`.

    ???+ example "例子"

        ```
        >>> import sys
        >>> sys.path
        ['', '/usr/lib64/python39.zip', '/usr/lib64/python3.9', '/usr/lib64/python3.9/lib-dynload', '/usr/lib64/python3.9/site-packages', '/usr/lib/python3.9/site-packages']
        ```

### `import`

`import`只能用于导入包或者模块, 不能导入模块内部的变量/函数/类. 使用内部变量/函数/类的时候要加包或者模块的前缀.

- `import [module]`, 前缀: `[module]`
- `import [package].[module]` 前缀: `[package].[module]`
- `import [package]`, 前缀: 无法加载包下的模块, 所以无法使用变量/函数/类

    ???+ warning "注意"

        这种情况下加载的其实是包下的`__init__.py`文件. 

        ??? example "例子"

            目录结构:

            ```sh
            .
            ├── pac
            │   ├── __init__.py
            │   └── demo.py
            └── run.py
            ```

            `__init__.py`文件:

            ```py
            print("hello")
            print(__name__)
            ```

            `run.py`文件:

            ```py
            import pac
            ```

            执行`run.py`

            ```sh
            $ python run.py
            hello
            demo
            ```

???+ example "例子"

    === "例子1"

        目录结构:

        ```sh
        .
        ├── demo.py
        └── run.py
        ```

        `demo.py`文件: 

        ```py
        name = "wenzexu"

        def main():
            print("导入成功")
            print(__name__)

        if __name__ == "__main__":
            main()
        ```

        `run.py`文件:

        ```py
        import demo

        print(demo.name)
        ```

        执行`run.py`: 

        ```sh
        $ python run.py
        wenzexu
        ```
    
    === "例子2"

        目录结构:

        ```sh
        .
        ├── pac
        │   ├── __init__.py
        │   └── demo.py
        └── run.py 
        ```

        `demo.py`文件:

        ```py
        name = "wenzexu"

        def main():
            print("导入成功")
            print(__name__)

        if __name__ == "__main__":
            main()
        ```

        `run.py`文件:

        ```py
        import pac.demo

        print(pac.demo.name) 
        ```

        运行`run.py`:

        ```sh
        $ python run.py
        wenzexu
        ```

[^1]: 【基础】什么是包、模块和库？—Python&图像处理教程 文档. (n.d.). Retrieved June 15, 2024, from http://await.fun/PythonTutorial/p06/1.html
[^2]: python中import的用法—PythonJoy. (n.d.). Retrieved June 15, 2024, from https://joy9191.github.io/16196181446571.html
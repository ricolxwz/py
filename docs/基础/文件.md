---
title: 文件
icon: material/file-tree
comments: true
---

## 文件读写

### `open()`

要以读文件的模式打开一个文件对象, 使用内置的`open()`函数. 

???+ example "例子"

    ```
    >>> f = open('/Users/wenzexu/test.txt', 'r')
    ```

    标识符`r`表示读. 

    ???+ note "笔记"
        
        如果文件不存在, 函数会抛出一个IOError的错误.

#### 参数

##### 模式

1. 文本模式

    - `r`: 读取模式, 文件用于读取, 如果文件不存在, 会引发`FileNotFoundError`
    - `w`: 写入模式, 如果文件存在会被清空, 如果文件不存在则创建新的文件
    - `a`: 追加模式, 如果文件存在, 写入内容追加到文件末尾, 如果文件不存在则穿件新的文件
    - `x`: 独占创建模式: 创建新文件用于写入, 如果文件已经存在则引发`FileExistsError`

2. 二进制模式

    - `rb`: 读取二进制文件 
    - `wb`: 写入二进制文件
    - `ab`: 追加二进制文件
    - `xb`: 独占创建二进制文件

3. 文本模式附加

    - `r+`: 读取和写入模式, 文件必须存在
    - `w+`: 写入和读取模式, 会清空文件内容, 如果文件不存在则创建新文件
    - `a+`: 追加和读取模式, 如果文件不存在则创建新文件
    - `x+`: 独占创建和读取模式, 如果文件已存在则引发`FileExistError`

4. 组合模式

    - `rb+`或`r+b`：读取和写入二进制文件
    - `wb+`或`w+b`：写入和读取二进制文件
    - `ab+`或`a+b`：追加和读取二进制文件
    - `xb+`或`x+b`：独占创建和读取二进制文件

##### 编码

默认编码为utf-8, 可以通过`enconding`参数设置编码.

???+ example "例子"

    ```
    >>> f = open('/Users/wenzexu/gbk.txt', 'r', encoding='gbk')
    ```

##### 错误

`errors`参数用于设置错误处理策略.

???+ example "例子"

    ```
    >>> f = open('/Users/wenzexu/gbk.txt', 'r', encoding='gbk', errors='ignore')
    ```

### `read()`/`readline()`/`readlines()`

如果文件打开成功, 并设置读权限, 可以用

- `read()`方法一次性读取文件的全部内容
- `readline()`读取一行内容
- `readlines()`读取所有内容并返回列表

???+ example "例子"

    ```
    >>> f.read()
    Hello, world!
    ```

???+ warning "注意"

    `read()`和`readlines()`是一次性读取所有内容, 如果文件太大, 可能会导致内存爆炸. 可以反复调用`read([size])`, 每次最多读取`size`个字节的内容. 

### `write()`

如果文件打开成功, 并设置写权限, 可以用`write()`来写入数据.

???+ example "例子"

    ```
    >>> f.write('Hello, world!')
    ```

???+ warning "注意"

    务必使用[`close()`](#close)关闭文件. 因为当我们写文件的时候, 操作系统往往不会把数据立刻写入磁盘, 而是先在内存中缓存, 然后空闲的时候写入. 只有调用了`close()`, 操作系统才能保证把没有写入的数据全部写入磁盘. 为了避免没有调用`close()`, 推荐使用`with`语句. 


### `close()` {#close}

文件使用完成后必须关闭, 否则会占用资源, 使用`close()`释放资源.

???+ example "例子"

    ```py
    try:
        f = open('/path/to/file', 'r')
        print(f.read())
    finally:
        if f:
            f.close()
    ```

    这可以保证无论出错与否都能正确地关闭文件.

???+ tip "Tip"

    `with`语句可以自动帮助我们调用`close()`方法. 

    ???+ example "例子"

        ```py
        with open('[path]', 'r') as f:
            print(f.read())
        ```
    
[^1]: 文件读写. (n.d.). Retrieved June 15, 2024, from https://www.liaoxuefeng.com/wiki/1016959663602400/1017607179232640
---
title: 文件
icon: material/file-tree
comments: true
---

## 文件读写

### `open()`

要以读文件的模式打开一个文件对象, 使用内置的`open()`函数. 

???+ example "例子"

    ```
    >>> f = open('/Users/wenzexu/test.txt', 'r')
    ```

    标识符`r`表示读. 

    ???+ note "笔记"
        
        如果文件不存在, 函数会抛出一个IOError的错误.

#### 参数

##### 模式

1. 文本模式

    - `r`: 读取模式, 文件用于读取, 如果文件不存在, 会引发`FileNotFoundError`
    - `w`: 写入模式, 如果文件存在会被清空, 如果文件不存在则创建新的文件
    - `a`: 追加模式, 如果文件存在, 写入内容追加到文件末尾, 如果文件不存在则穿件新的文件
    - `x`: 独占创建模式: 创建新文件用于写入, 如果文件已经存在则引发`FileExistsError`

2. 二进制模式

    - `rb`: 读取二进制文件 
    - `wb`: 写入二进制文件
    - `ab`: 追加二进制文件
    - `xb`: 独占创建二进制文件

3. 文本模式附加

    - `r+`: 读取和写入模式, 文件必须存在
    - `w+`: 写入和读取模式, 会清空文件内容, 如果文件不存在则创建新文件
    - `a+`: 追加和读取模式, 如果文件不存在则创建新文件
    - `x+`: 独占创建和读取模式, 如果文件已存在则引发`FileExistError`

4. 组合模式

    - `rb+`或`r+b`：读取和写入二进制文件
    - `wb+`或`w+b`：写入和读取二进制文件
    - `ab+`或`a+b`：追加和读取二进制文件
    - `xb+`或`x+b`：独占创建和读取二进制文件

##### 编码

默认编码为utf-8, 可以通过`enconding`参数设置编码.

???+ example "例子"

    ```
    >>> f = open('/Users/wenzexu/gbk.txt', 'r', encoding='gbk')
    ```

##### 错误

`errors`参数用于设置错误处理策略.

???+ example "例子"

    ```
    >>> f = open('/Users/wenzexu/gbk.txt', 'r', encoding='gbk', errors='ignore')
    ```

### `read()`/`readline()`/`readlines()`

如果文件打开成功, 并设置读权限, 可以用

- `read()`方法一次性读取文件的全部内容
- `readline()`读取一行内容
- `readlines()`读取所有内容并返回列表

???+ example "例子"

    ```
    >>> f.read()
    Hello, world!
    ```

???+ warning "注意"

    `read()`和`readlines()`是一次性读取所有内容, 如果文件太大, 可能会导致内存爆炸. 可以反复调用`read([size])`, 每次最多读取`size`个字节的内容. 

### `write()`

如果文件打开成功, 并设置写权限, 可以用`write()`来写入数据.

???+ example "例子"

    ```
    >>> f.write('Hello, world!')
    ```

???+ warning "注意"

    务必使用[`close()`](#close)关闭文件. 因为当我们写文件的时候, 操作系统往往不会把数据立刻写入磁盘, 而是先在内存中缓存, 然后空闲的时候写入. 只有调用了`close()`, 操作系统才能保证把没有写入的数据全部写入磁盘. 为了避免没有调用`close()`, 推荐使用`with`语句. 


### `close()` {#close}

文件使用完成后必须关闭, 否则会占用资源, 使用`close()`释放资源.

???+ example "例子"

    ```py
    try:
        f = open('/path/to/file', 'r')
        print(f.read())
    finally:
        if f:
            f.close()
    ```

    这可以保证无论出错与否都能正确地关闭文件.

???+ tip "Tip"

    `with`语句可以自动帮助我们调用`close()`方法. 

    ???+ example "例子"

        ```py
        with open('[path]', 'r') as f:
            print(f.read())
        ```

## `os`模块

如果我们要操作文件、目录, 可以在bash下使用`dir, cp`等命令, 这些命令实际上是调用了操作系统提供的接口. Python内置的`os`模也可以直接调用操作系统的接口实现相同的功能. 

### 获取操作系统信息

要获取操作系统信息, 可以查看`os.name`属性获取操作系统类型或者调用`os.uname()`函数获取详细信息.

???+ example "例子"

    ```
    >>> import os
    >>> os.name
    'posix'
    >>> os.uname()
    posix.uname_result(sysname='Darwin', nodename='wenzexus-Mac-mini.local', release='23.5.0', version='Darwin Kernel Version 23.5.0: Wed May  1 20:19:05 PDT 2024; root:xnu-10063.121.3~5/RELEASE_ARM64_T8112', machine='arm64')
    ```

    ???+ tip "Tip"

        - `uname()`函数在Windows上不提供
        - `name`属性的结果如果是`posix`, 说明系统是Linux, Unix或MacOS; 如果是`nt`, 就是Windows

### 环境变量

#### 读取环境变量

读取环境变量, 可以用到`os.environ`对象的`get()`方法: 

???+ example "例子"

    ```
    >>> import os
    >>> os.environ.get('PATH')
    '/home/wenzexu/.local/bin:/home/wenzexu/bin:/opt/orbstack-guest/bin-hiprio:/opt/orbstack-guest/data/bin/cmdlinks:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/orbstack-guest/bin' 
    ```

???+ tip "Tip"

    可以通过对象名打印对象:

    ???+ example "例子"

        ```
        >>> os.environ
        environ({'VERSIONER_PYTHON_PREFER_32_BIT': 'no', 'TERM_PROGRAM_VERSION': '326', 'LOGNAME': 'michael', 'USER': 'michael', 'PATH': '/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin:/usr/local/mysql/bin', ...})
        ```

#### 写入环境变量

`os.environ`是一个字典样式的对象, 允许通过键值对的方式操作环境变量. 

???+ example "例子"

    ```
    >>> import os
    >>> os.environ['[ENV]'] = '[ENV_VALUE]'
    ```

### 操作文件和目录

???+ example "例子"

    === "查看当前目录绝对路径"

        ```
        >>> os.path.abspath('.')
        '/Users/wenzexu'
        ```

[^1]: 文件读写. (n.d.). Retrieved June 15, 2024, from https://www.liaoxuefeng.com/wiki/1016959663602400/1017607179232640
[^2]: 操作文件和目录—廖雪峰的官方网站. (n.d.). Retrieved June 15, 2024, from https://www.liaoxuefeng.com/wiki/1016959663602400/1017623135437088
---
title: 数组索引
icon: material/dice-multiple-outline
comments: true
---

???+ info "信息"

    默认省略导入`import numpy as np`.

???+ tip "Tip"

    `x[([exp1], [exp2], ..., [expN])]`和`x[[exp1], [exp2], ..., [expN]]`是相等的, 后者是前者的语法糖.

## 基础索引

???+ warning "注意"

    基础索引产生的新数组是[视图](/NumPy/视图副本/#视图).

### 单一元素索引 {#单一元素索引}

在一维数组中的单一元素索引和在原生列表中的单一元素索引没有区别. 都是从0开始, 能够接受负数表示从末尾开始索引. 同样对于多维数组来说, 也和原生列表相似. 

???+ example "例子"

    ```
    >>> x = np.arange(10)
    >>> x[2]
    2
    >>> x[-2]
    8
    >>> x.shape = (2, 5) # 不会创建新视图, 因为这是修改原数组的元数据
    >>> x[1, 3]
    8
    >>> x[1, -1]
    9
    ```

    ???+ note "笔记"

        如果用比维度少的索引来索引多维数组, 会得到一个子维数组, 这个子维数组是一个[视图](/NumPy/视图副本/#视图).

        ???+ example "例子"

            ```
            >>> x = np.arange(10)
            >>> x.shape = (2, 5)
            >>> x[0]
            array([0, 1, 2, 3, 4])
            >>> x[0].base # 使用base属性判断是视图还是副本
            array([[0, 1, 2, 3, 4],
                   [5, 6, 7, 8, 9]]) # 为原数组所以为视图
            >>> x[0][2]
            ```

    ???+ tip "Tip"

        `x[u, v] == x[u][v]`但是`x[u][v]`的效率更低, 因为`x[u]`会创建一个新视图, 随后在这个新视图上再进行索引.
    
### 切片

???+ warning "注意"

    - NumPy切片创建的是[视图](/NumPy/视图副本/#视图), 而不像内置的Python序列如字符串, 元组和列表那样经过切片产生的是一个副本.
    - 从大数组中切片得到一个小的数组之后, 如果小数组不再发挥作用, 必须要小心, 因为小数组中的访问缓冲区和大数组中的数据缓冲区都是同一个, 当要删除大数组时, 必须删除全部由其派生的小数组, 数据缓冲区/内存才会被释放. 所以在这种情况下, 建议使用[副本](/NumPy/视图副本/#副本).

序列切片的规则适用于每个维度, 同一个维度使用`[start]:[end]:[stride]`, 维度之间用`,`进行分割.

???+ note "笔记"

    - 含义

        - `[start]`: 表示想要的第一项的下标
        - `[end]`: 表示第一个不想要的项的下标
        - `[stride]`: 定义了向前(负数)还是向后(正数)以及步长

    - 默认值: 假设n是某一个维度的待切片的元素的数量.

        - `[start]`: 若`[stride]`小于0, 默认为n-1; 若`[stride]`大于0, 默认为0. 
        - `[end]`: 若`[stride]`小于0, 默认为-n-1; 若`[stride]`大于0, 默认为n
        - `[stride]`: 默认为1

???+ example "例子"

    === "一维数组切片"

        ```
        >>> a = np.arange(12)
        >>> a
        array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])
        >>> a[:4]
        array([0, 1, 2, 3])
        >>> a[1:]
        array([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])
        >>> a[1:3]
        array([1, 2])
        >>> a[1:10:2]
        array([1, 3, 5, 7, 9])
        >>> a[-3:3]
        array([], dtype=int64) # 步长默认为1, 所以没有选中任何元素
        >>> a[-3:3:-1]
        array([9, 8, 7, 6, 5, 4])
        >>> a[::-1] # 步长为1, 是一个负数, 所以[start]默认为11, [end]默认为-13
        array([11, 10,  9,  8,  7,  6,  5,  4,  3,  2,  1,  0])
        ```

???+ tip "Tip"

    - 当使用一个整数`i`进行索引的时候, 即[单一元素索引](#单一元素索引). 它返回与`i:i+1`相同的值, 维度减少了1.

        ???+ example "例子"

            ```
            >>> a = np.arange(12)
            >>> a
            array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])
            >>> a[1] # 返回的是a[1:2], 返回的维度减少了1, 从1维变为0维
            1
            >>> arr = np.array([[1, 2, 3], [4, 5, 6]])
            >>> arr[0] # 返回的是a[0:1], 返回的维度减少了1, 从2维变为1维
            array([1, 2, 3])
            ```
    - `[start]:[end]:[stride]`与由`slice`类创建的切片对象含义相同.

        ???+ example "例子"

            ```
            >>> arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            >>> s = slice(2, 8, 2)
            >>> arr[s]
            [2, 4, 6]
            ```

[^1]: Indexing on ndarrays—NumPy v2.0 Manual. (n.d.). Retrieved June 21, 2024, from https://numpy.org/doc/stable/user/basics.indexing.html
[^2]: 理解python索引和切片 · Issue #15 · qiwihui/blog. (n.d.). GitHub. Retrieved June 21, 2024, from https://github.com/qiwihui/blog/issues/15